# fhir-gateway

![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square)

A Helm chart for deploying the MIRACUM FHIR Gateway

**Homepage:** <https://github.com/miracum/fhir-gateway>

## Installation

```sh
helm install --create-namespace -n fhir-gateway fhir-gateway oci://ghcr.io/miracum/charts/fhir-gateway
```

## Values

| Key                                                    | Type   | Default                                               | Description                                                                                                                                                                                                                                                                                                                                   |
| ------------------------------------------------------ | ------ | ----------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| affinity                                               | object | `{}`                                                  | affinity for pods assignment see: <https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity>                                                                                                                                                                                                             |
| common.deploymentAnnotations                           | object | `{}`                                                  | metadata.annotations to apply to all deployments                                                                                                                                                                                                                                                                                              |
| extraEnv                                               | list   | `[]`                                                  | extra environment vars to set on the FHIR gateway container                                                                                                                                                                                                                                                                                   |
| fhir-pseudonymizer.enabled                             | bool   | `true`                                                | whether to enable the FHIR Pseudonymizer - a thin, FHIR-native wrapper on top of gPAS, Vfps, or entici with additional options for anonymization. if this is set to false, then the FHIR gateway will not attempt to pseudonymize/anonymize the resources.                                                                                    |
| fhir-pseudonymizer.pseudonymizationService             | string | `"None"`                                              | set the pseudonymization service backend                                                                                                                                                                                                                                                                                                      |
| fullnameOverride                                       | string | `""`                                                  | String to fully override fullname template                                                                                                                                                                                                                                                                                                    |
| imagePullSecrets                                       | list   | `[]`                                                  | image pull secrets for the pod                                                                                                                                                                                                                                                                                                                |
| ingress.annotations                                    | object | `{}`                                                  | ingress annotations                                                                                                                                                                                                                                                                                                                           |
| ingress.enabled                                        | bool   | `false`                                               | if enabled, create an Ingress to expose the FHIR Gateway outside the cluster                                                                                                                                                                                                                                                                  |
| ingress.hosts                                          | list   | `[{"host":"chart-example.local","paths":["/"]}]`      | configure the hostname                                                                                                                                                                                                                                                                                                                        |
| ingress.ingressClassName                               | string | `""`                                                  | the ingressClassName                                                                                                                                                                                                                                                                                                                          |
| ingress.tls                                            | list   | `[]`                                                  | TLS config                                                                                                                                                                                                                                                                                                                                    |
| initContainers.resources                               | object | `{}`                                                  | configure the init containers pods resource requests and limits manually                                                                                                                                                                                                                                                                      |
| initContainers.resourcesPreset                         | string | `"nano"`                                              | set container resources according to one common preset (allowed values: none, nano, micro, small, medium, large, xlarge, 2xlarge). This is ignored if primary.resources is set (primary.resources is recommended for production). More information: <https://github.com/bitnami/charts/blob/main/bitnami/common/templates/_resources.tpl#L15> |
| kafka.enabled                                          | bool   | `false`                                               | if enabled, the FHIR Gateway is able to use Kafka as input and/or output. Requires the Kafka cluster to be configured using <https://strimzi.io/>                                                                                                                                                                                             |
| kafka.processor.consumeOnly                            | bool   | `false`                                               | if enabled, the FHIR Gateway will only read and process resources from the specified Kafka topics `inputTopics` but not write them back to Kafka                                                                                                                                                                                              |
| kafka.processor.enabled                                | bool   | `false`                                               | if enabled, the FHIR Gateway will read resources from the specified Kafka topics `inputTopics` and write them to dynamic output topics.                                                                                                                                                                                                       |
| kafka.processor.generateOutputTopics.matchExpression   | string | `"^"`                                                 | Allows for dynamically generating the Kafka output topic's name based on the input topic. Set to a regular expression which is applied to the input topic and the first match is replaced with the value of `kafka.generateOutputTopics.replaceWith`. You can set this to "^" to add a prefix to the output topic.                            |
| kafka.processor.generateOutputTopics.replaceMatchWith  | string | `"fhir.post-gateway."`                                | value to replace the first regex match with                                                                                                                                                                                                                                                                                                   |
| kafka.processor.groupId                                | string | `"{{ include \"fhir-gateway.fullname\" . }}-gateway"` | the Kafka consumer group id. Evaluated as a template.                                                                                                                                                                                                                                                                                         |
| kafka.processor.inputTopics                            | list   | `["fhir-raw"]`                                        | list of Kafka topics to read FHIR resources from                                                                                                                                                                                                                                                                                              |
| kafka.securityProtocol                                 | string | `"PLAINTEXT"`                                         | either PLAINTEXT or SSL                                                                                                                                                                                                                                                                                                                       |
| kafka.storeFromAPI.enabled                             | bool   | `false`                                               | if enabled, the FHIR Gateway will send resources received from API to the specified Kafka topic `outputTopic` after they are processed                                                                                                                                                                                                        |
| kafka.storeFromAPI.outputTopic                         | string | `"fhir.post-gateway.api.output"`                      | the Kafka topic to send API received resources to                                                                                                                                                                                                                                                                                             |
| kafka.strimziClusterName                               | string | `"my-cluster"`                                        | name of the Strimzi Kafka CRD this gateway should connect to. This is used to resolve the Kafka bootstrap service.                                                                                                                                                                                                                            |
| loincConverter.affinity                                | object | `{}`                                                  | affinity for pods assignment see: <https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity>                                                                                                                                                                                                             |
| loincConverter.enabled                                 | bool   | `true`                                                | whether to enable the LOINC conversion and harmonization service                                                                                                                                                                                                                                                                              |
| loincConverter.extraEnv                                | list   | `[]`                                                  | extra environment variables to set on the loinc conversion container                                                                                                                                                                                                                                                                          |
| loincConverter.imagePullSecrets                        | list   | `[]`                                                  | credentials to use when pulling the image                                                                                                                                                                                                                                                                                                     |
| loincConverter.metrics.serviceMonitor.additionalLabels | object | `{}`                                                  | additional labels for the ServiceMonitor resource, e.g. `release: prometheus`                                                                                                                                                                                                                                                                 |
| loincConverter.metrics.serviceMonitor.enabled          | bool   | `false`                                               | if enabled, creates a ServiceMonitor instance for Prometheus Operator-based monitoring                                                                                                                                                                                                                                                        |
| loincConverter.nodeSelector                            | object | `{}`                                                  | node labels for pods assignment see: <<https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/>>                                                                                                                                                                                                                             |
| loincConverter.podAnnotations                          | object | `{}`                                                  | annotations for the pod                                                                                                                                                                                                                                                                                                                       |
| loincConverter.replicaCount                            | int    | `1`                                                   | if necessary, the service can easily scale horizontally                                                                                                                                                                                                                                                                                       |
| loincConverter.resources                               | object | `{}`                                                  | configure the resource requests and limits manually                                                                                                                                                                                                                                                                                           |
| loincConverter.resourcesPreset                         | string | `"medium"`                                            | set container resources according to one common preset (allowed values: none, nano, micro, small, medium, large, xlarge, 2xlarge). This is ignored if primary.resources is set (primary.resources is recommended for production). More information: <https://github.com/bitnami/charts/blob/main/bitnami/common/templates/_resources.tpl#L15> |
| loincConverter.service.port                            | int    | `8080`                                                | port for the conversion REST endpoint                                                                                                                                                                                                                                                                                                         |
| loincConverter.service.type                            | string | `"ClusterIP"`                                         | service type                                                                                                                                                                                                                                                                                                                                  |
| loincConverter.tolerations                             | list   | `[]`                                                  | tolerations for pods assignment see: <https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/>                                                                                                                                                                                                                                |
| metrics.serviceMonitor.additionalLabels                | object | `{}`                                                  | additional labels for the ServiceMonitor resource, e.g. `release: prometheus`                                                                                                                                                                                                                                                                 |
| metrics.serviceMonitor.enabled                         | bool   | `false`                                               | if enabled, creates a ServiceMonitor instance for Prometheus Operator-based monitoring                                                                                                                                                                                                                                                        |
| nameOverride                                           | string | `""`                                                  | String to partially override fullname template (will maintain the release name)                                                                                                                                                                                                                                                               |
| nodeSelector                                           | object | `{}`                                                  | node labels for pods assignment see: <<https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/>>                                                                                                                                                                                                                             |
| podAnnotations                                         | object | `{}`                                                  | annotations to apply to the pod                                                                                                                                                                                                                                                                                                               |
| postgresql.auth.database                               | string | `"fhir_gateway"`                                      | name of the database to create see: <https://github.com/bitnami/containers/tree/main/bitnami/postgresql#creating-a-database-on-first-run>                                                                                                                                                                                                     |
| postgresql.auth.enablePostgresUser                     | bool   | `true`                                                | assign a password to the "postgres" admin user. Otherwise, remote access will be blocked for this user                                                                                                                                                                                                                                        |
| postgresql.enabled                                     | bool   | `true`                                                | enabled the included Postgres DB see <https://github.com/bitnami/charts/tree/master/bitnami/postgresql> for configuration options                                                                                                                                                                                                             |
| replicaCount                                           | int    | `1`                                                   | number of replicas. The application is well-suited to scale horizontally if required.                                                                                                                                                                                                                                                         |
| resources                                              | object | `{}`                                                  | manually set the resource requests and limits                                                                                                                                                                                                                                                                                                 |
| resourcesPreset                                        | string | `"small"`                                             | set container resources according to one common preset (allowed values: none, nano, micro, small, medium, large, xlarge, 2xlarge). This is ignored if primary.resources is set (primary.resources is recommended for production). More information: <https://github.com/bitnami/charts/blob/main/bitnami/common/templates/_resources.tpl#L15> |
| service.metricsPort                                    | int    | `8081`                                                | port of the actuator/metrics endpoint                                                                                                                                                                                                                                                                                                         |
| service.port                                           | int    | `8080`                                                | port of the FHIR REST endpoint                                                                                                                                                                                                                                                                                                                |
| service.type                                           | string | `"ClusterIP"`                                         | service type                                                                                                                                                                                                                                                                                                                                  |
| serviceAccount.annotations                             | object | `{}`                                                  | annotations to add to the service account                                                                                                                                                                                                                                                                                                     |
| serviceAccount.automountServiceAccountToken            | bool   | `false`                                               | whether to automount the SA token.                                                                                                                                                                                                                                                                                                            |
| serviceAccount.create                                  | bool   | `false`                                               | specifies whether a service account should be created.                                                                                                                                                                                                                                                                                        |
| serviceAccount.name                                    | string | `""`                                                  | the name of the service account to use. If not set and create is true, a name is generated using the fullname template                                                                                                                                                                                                                        |
| sinks.fhirServer.enabled                               | bool   | `false`                                               | if enabled, sends all received resources to the specified FHIR server                                                                                                                                                                                                                                                                         |
| sinks.fhirServer.url                                   | string | `""`                                                  | URL of the FHIR server. Set basic auth parameters via `extraEnv`                                                                                                                                                                                                                                                                              |
| sinks.postgres.enabled                                 | bool   | `true`                                                | if enabled, writes all received FHIR resources to a Postgres DB if `postgresql.enabled=true`, then a Postgres DB is started as part of this installation. If `postgresql.enabled=false`, then `sinks.postgres.external.*` is used.                                                                                                            |
| sinks.postgres.external.database                       | string | `""`                                                  | name of the database to connect to                                                                                                                                                                                                                                                                                                            |
| sinks.postgres.external.existingSecret                 | string | `""`                                                  | can be used to specify the name of an existing secret containing the PostgreSQL password. An alternative to setting the password above.                                                                                                                                                                                                       |
| sinks.postgres.external.existingSecretKey              | string | `"postgresql-password"`                               | the key inside the `existingSecret` containing the password.                                                                                                                                                                                                                                                                                  |
| sinks.postgres.external.host                           | string | `""`                                                  | host or server name                                                                                                                                                                                                                                                                                                                           |
| sinks.postgres.external.password                       | string | `""`                                                  | password for the user                                                                                                                                                                                                                                                                                                                         |
| sinks.postgres.external.port                           | string | `"5432"`                                              | port                                                                                                                                                                                                                                                                                                                                          |
| sinks.postgres.external.username                       | string | `""`                                                  | username to authenticate as                                                                                                                                                                                                                                                                                                                   |
| tolerations                                            | list   | `[]`                                                  | tolerations for pods assignment see: <https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/>                                                                                                                                                                                                                                |
| waitForPostgresInitContainer                           | object | `{}`                                                  |                                                                                                                                                                                                                                                                                                                                               |
