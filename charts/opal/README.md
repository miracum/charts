# opal

![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square)

A Helm chart for deploying the opal server, a DataShield rock cluster, and the QP poll server.

**Homepage:** <https://opaldoc.obiba.org/en/latest/index.html>

## Installation

```sh
helm install --create-namespace -n opal opal oci://ghcr.io/miracum/charts/opal
```

## Values

| Key                                         | Type   | Default                                                                                                                                                                                                                 | Description                                                                                                                                                                                                                                                           |
| ------------------------------------------- | ------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| dsPoll.affinity                             | object | `{}`                                                                                                                                                                                                                    | pod affinity                                                                                                                                                                                                                                                          |
| dsPoll.enabled                              | bool   | `false`                                                                                                                                                                                                                 | enable the QP poll component. See <https://github.com/medizininformatik-initiative/distributed-analysis_datashield-qp>                                                                                                                                                |
| dsPoll.nodeSelector                         | object | `{}`                                                                                                                                                                                                                    | pod node selector                                                                                                                                                                                                                                                     |
| dsPoll.podSecurityContext                   | object | `{}`                                                                                                                                                                                                                    | pod security context                                                                                                                                                                                                                                                  |
| dsPoll.queueServerHost                      | string | `""`                                                                                                                                                                                                                    | the host of the queue server component                                                                                                                                                                                                                                |
| dsPoll.replicaCount                         | int    | `1`                                                                                                                                                                                                                     | number of replicas                                                                                                                                                                                                                                                    |
| dsPoll.resources                            | object | `{}`                                                                                                                                                                                                                    | resource requests and limits                                                                                                                                                                                                                                          |
| dsPoll.tolerations                          | list   | `[]`                                                                                                                                                                                                                    | pod tolerations                                                                                                                                                                                                                                                       |
| fullnameOverride                            | string | `""`                                                                                                                                                                                                                    | override the full release name                                                                                                                                                                                                                                        |
| nameOverride                                | string | `""`                                                                                                                                                                                                                    | override the release name                                                                                                                                                                                                                                             |
| opal.affinity                               | object | `{}`                                                                                                                                                                                                                    | pod affinity                                                                                                                                                                                                                                                          |
| opal.auth.administrator.password            | string | `""`                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                       |
| opal.auth.administrator.passwordSecret.key  | string | `""`                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                       |
| opal.auth.administrator.passwordSecret.name | string | `""`                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                       |
| opal.database.data.database                 | string | `"opal_data"`                                                                                                                                                                                                           | name of the database inside. If postgresql.enabled=true, then postgresql.postgresqlDatabase is used                                                                                                                                                                   |
| opal.database.data.existingSecret.key       | string | `"password"`                                                                                                                                                                                                            | name of the key in `database.data.existingSecret.name` to use as the password to the DB.                                                                                                                                                                              |
| opal.database.data.existingSecret.name      | string | `""`                                                                                                                                                                                                                    | name of an existing secret containing the password to the DB.                                                                                                                                                                                                         |
| opal.database.data.host                     | string | `"data.host.example.com"`                                                                                                                                                                                               | database hostname of an external database used to store data. Only used if `postgresql.enabled` is set to `false`.                                                                                                                                                    |
| opal.database.data.password                 | string | `"opal_data_password"`                                                                                                                                                                                                  | the database password. Only used if postgresql.enabled=false, otherwise the secret created by the postgresql chart is used                                                                                                                                            |
| opal.database.data.port                     | int    | `5432`                                                                                                                                                                                                                  | port used to connect to the postgres DB                                                                                                                                                                                                                               |
| opal.database.data.username                 | string | `"opal_data_admin"`                                                                                                                                                                                                     | username used to connect to the DB. Note that this name is currently used even if postgresql.enabled=true                                                                                                                                                             |
| opal.database.ids.database                  | string | `"opal_ids"`                                                                                                                                                                                                            | name of the database inside. If postgresql.enabled=true, then postgresql.postgresqlDatabase is used                                                                                                                                                                   |
| opal.database.ids.existingSecret.key        | string | `"password"`                                                                                                                                                                                                            | name of the key in `database.data.existingSecret.name` to use as the password to the DB.                                                                                                                                                                              |
| opal.database.ids.existingSecret.name       | string | `""`                                                                                                                                                                                                                    | name of an existing secret containing the password to the DB.                                                                                                                                                                                                         |
| opal.database.ids.host                      | string | `"data.host.example.com"`                                                                                                                                                                                               | database hostname of an external database used to store ids. Only used if `postgresql.enabled` is set to `false`.                                                                                                                                                     |
| opal.database.ids.password                  | string | `"opal"`                                                                                                                                                                                                                | the database password. Only used if postgresql.enabled=false, otherwise the secret created by the postgresql chart is used                                                                                                                                            |
| opal.database.ids.port                      | int    | `5432`                                                                                                                                                                                                                  | port used to connect to the postgres DB                                                                                                                                                                                                                               |
| opal.database.ids.username                  | string | `"opal_ids_password"`                                                                                                                                                                                                   | username used to connect to the DB. Note that this name is currently used even if postgresql.enabled=true                                                                                                                                                             |
| opal.extraEnv                               | list   | `[]`                                                                                                                                                                                                                    | extra environment variables to set on the opal api container                                                                                                                                                                                                          |
| opal.imagePullSecrets                       | list   | `[]`                                                                                                                                                                                                                    | image pull secrets used by the opal container                                                                                                                                                                                                                         |
| opal.ingress.annotations                    | object | `{}`                                                                                                                                                                                                                    | extra annotations to apply to the Ingress resource                                                                                                                                                                                                                    |
| opal.ingress.className                      | string | `""`                                                                                                                                                                                                                    | ingressClassName to use                                                                                                                                                                                                                                               |
| opal.ingress.enabled                        | bool   | `false`                                                                                                                                                                                                                 | create an Ingress for the application                                                                                                                                                                                                                                 |
| opal.ingress.hosts                          | list   | `[{"host":"opal.127.0.0.1.nip.io","paths":[{"path":"/","pathType":"ImplementationSpecific","portName":"http"}]}]`                                                                                                       | list of ingress hosts                                                                                                                                                                                                                                                 |
| opal.ingress.tls                            | list   | `[]`                                                                                                                                                                                                                    | TLS configuration                                                                                                                                                                                                                                                     |
| opal.nodeSelector                           | object | `{}`                                                                                                                                                                                                                    | pod node selector                                                                                                                                                                                                                                                     |
| opal.persistence                            | object | `{"accessModes":["ReadWriteOnce"],"annotations":{},"enabled":true,"existingClaim":"","labels":{},"selector":{},"size":"8Gi","storageClass":""}`                                                                         | configuration for the server persistence                                                                                                                                                                                                                              |
| opal.persistence.accessModes                | list   | `["ReadWriteOnce"]`                                                                                                                                                                                                     | PVC Access Mode for data volume                                                                                                                                                                                                                                       |
| opal.persistence.annotations                | object | `{}`                                                                                                                                                                                                                    | annotations for the PVC                                                                                                                                                                                                                                               |
| opal.persistence.enabled                    | bool   | `true`                                                                                                                                                                                                                  | enable data persistence using PVC                                                                                                                                                                                                                                     |
| opal.persistence.existingClaim              | string | `""`                                                                                                                                                                                                                    | name of an existing PVC to use                                                                                                                                                                                                                                        |
| opal.persistence.labels                     | object | `{}`                                                                                                                                                                                                                    | labels for the PVC                                                                                                                                                                                                                                                    |
| opal.persistence.selector                   | object | `{}`                                                                                                                                                                                                                    | selector to match an existing Persistent Volume (this value is evaluated as a template) selector: matchLabels: app: my-app                                                                                                                                            |
| opal.persistence.size                       | string | `"8Gi"`                                                                                                                                                                                                                 | PVC Storage Request for volume                                                                                                                                                                                                                                        |
| opal.persistence.storageClass               | string | `""`                                                                                                                                                                                                                    | PVC Storage Class for data volume If defined, storageClassName: <storageClass> If set to "-", storageClassName: "", which disables dynamic provisioning If undefined (the default) or set to null, no storageClassName spec is set, choosing the default provisioner. |
| opal.podAnnotations                         | object | `{}`                                                                                                                                                                                                                    | annotations to set on the opal pod                                                                                                                                                                                                                                    |
| opal.podSecurityContext                     | object | `{"fsGroup":101}`                                                                                                                                                                                                       | the pod security context                                                                                                                                                                                                                                              |
| opal.replicaCount                           | int    | `1`                                                                                                                                                                                                                     | number of replicas. Should be kept as 1 unless ReadWriteMany persistence is used                                                                                                                                                                                      |
| opal.resources                              | object | `{}`                                                                                                                                                                                                                    | resource limits and requests                                                                                                                                                                                                                                          |
| opal.service.httpsPort                      | int    | `8443`                                                                                                                                                                                                                  | the port for the TLS-secured interface                                                                                                                                                                                                                                |
| opal.service.port                           | int    | `8080`                                                                                                                                                                                                                  | the port for the main web interface                                                                                                                                                                                                                                   |
| opal.service.type                           | string | `"ClusterIP"`                                                                                                                                                                                                           | the type of service                                                                                                                                                                                                                                                   |
| opal.tolerations                            | list   | `[]`                                                                                                                                                                                                                    | pod tolerations                                                                                                                                                                                                                                                       |
| rock.affinity                               | object | `{}`                                                                                                                                                                                                                    | pod affinity                                                                                                                                                                                                                                                          |
| rock.nodeSelector                           | object | `{}`                                                                                                                                                                                                                    | pod node selector                                                                                                                                                                                                                                                     |
| rock.persistence                            | object | `{"accessModes":["ReadWriteOnce"],"annotations":{},"enabled":true,"existingClaim":"","labels":{},"selector":{},"size":"8Gi","storageClass":""}`                                                                         | configuration for the server persistence                                                                                                                                                                                                                              |
| rock.persistence.accessModes                | list   | `["ReadWriteOnce"]`                                                                                                                                                                                                     | PVC Access Mode for data volume                                                                                                                                                                                                                                       |
| rock.persistence.annotations                | object | `{}`                                                                                                                                                                                                                    | annotations for the PVC                                                                                                                                                                                                                                               |
| rock.persistence.enabled                    | bool   | `true`                                                                                                                                                                                                                  | enable data persistence using PVC                                                                                                                                                                                                                                     |
| rock.persistence.existingClaim              | string | `""`                                                                                                                                                                                                                    | name of an existing PVC to use                                                                                                                                                                                                                                        |
| rock.persistence.labels                     | object | `{}`                                                                                                                                                                                                                    | labels for the PVC                                                                                                                                                                                                                                                    |
| rock.persistence.selector                   | object | `{}`                                                                                                                                                                                                                    | selector to match an existing Persistent Volume (this value is evaluated as a template) selector: matchLabels: app: my-app                                                                                                                                            |
| rock.persistence.size                       | string | `"8Gi"`                                                                                                                                                                                                                 | PVC Storage Request for volume                                                                                                                                                                                                                                        |
| rock.persistence.storageClass               | string | `""`                                                                                                                                                                                                                    | PVC Storage Class for data volume If defined, storageClassName: <storageClass> If set to "-", storageClassName: "", which disables dynamic provisioning If undefined (the default) or set to null, no storageClassName spec is set, choosing the default provisioner. |
| rock.podSecurityContext                     | object | `{"fsGroup":105}`                                                                                                                                                                                                       | pod security context                                                                                                                                                                                                                                                  |
| rock.replicaCount                           | int    | `1`                                                                                                                                                                                                                     | number of rock instances in the cluster                                                                                                                                                                                                                               |
| rock.resources                              | object | `{}`                                                                                                                                                                                                                    | resource limits and requests                                                                                                                                                                                                                                          |
| rock.securityContext                        | object | `{"allowPrivilegeEscalation":false,"capabilities":{"drop":["ALL"]},"privileged":false,"readOnlyRootFilesystem":true,"runAsGroup":65534,"runAsNonRoot":true,"runAsUser":105,"seccompProfile":{"type":"RuntimeDefault"}}` | container security context                                                                                                                                                                                                                                            |
| rock.service.port                           | int    | `8085`                                                                                                                                                                                                                  | the port for the REST API                                                                                                                                                                                                                                             |
| rock.service.type                           | string | `"ClusterIP"`                                                                                                                                                                                                           | the type of service                                                                                                                                                                                                                                                   |
| rock.tolerations                            | list   | `[]`                                                                                                                                                                                                                    | pod tolerations                                                                                                                                                                                                                                                       |
| tests.resources                             | object | `{}`                                                                                                                                                                                                                    | configure the test pods resource requests and limits                                                                                                                                                                                                                  |

---

Autogenerated from chart metadata using [helm-docs v1.11.0](https://github.com/norwoodj/helm-docs/releases/v1.11.0)
